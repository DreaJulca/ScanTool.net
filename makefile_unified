# Unified Makefile for ScanTool.net
# Uses single compilation unit to avoid multiple definition errors

CC = C:/MinGW/bin/mingw32-gcc
CFLAGS = -O -Wall -mwindows -IC:/MinGW/include
LIBS = -lalleg
TARGET = ScanTool.exe
UNIFIED_SRC = scantool_unified.c
OBJS = listports.o

# Default target
all: $(TARGET)

# Build the main executable using unified compilation
$(TARGET): $(OBJS) $(UNIFIED_SRC)
	$(CC) $(CFLAGS) -o $(TARGET) $(OBJS) $(UNIFIED_SRC) $(LIBS)

# Build listports.o separately (doesn't use Allegro)
listports.o: listports.c
	$(CC) $(CFLAGS) -c listports.c

clean:
	del /f *.o $(TARGET) 2>nul || true

.PHONY: all clean
